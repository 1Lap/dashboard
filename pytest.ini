# pytest configuration for 1Lap Dashboard Server
#
# Quick reference:
#   pytest -v                    # Run all tests (verbose)
#   pytest -m unit               # Run only unit tests
#   pytest -m integration        # Run only integration tests
#   pytest -m "not slow"         # Skip slow tests
#   pytest --cov=app             # Run with coverage
#   pytest tests/test_foo.py     # Run specific test file
#   pytest -k "test_create"      # Run tests matching pattern
#
# Coverage:
#   pytest --cov=app --cov-report=html
#   open htmlcov/index.html

[pytest]
# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Directories to search for tests
testpaths = tests

# Output options
addopts =
    -v
    --strict-markers
    --tb=short
    --disable-warnings
    # Uncomment below to enable coverage by default (currently opt-in via --cov flag)
    # --cov=app
    # --cov-report=html
    # --cov-report=term-missing
    # --cov-fail-under=80

# Custom markers
# Usage: @pytest.mark.unit or @pytest.mark.integration
markers =
    unit: Unit tests (fast, isolated, test individual components)
    integration: Integration tests (slower, end-to-end, test complete workflows)
    slow: Slow tests that can be skipped with -m "not slow"

# Test collection options
# Don't collect files/directories matching these patterns
norecursedirs =
    .git
    .tox
    venv
    env
    __pycache__
    htmlcov
    _archive

# Minimum Python version (optional but good practice)
minversion = 7.0

# ==============================================================================
# Coverage Configuration (when using --cov flag)
# ==============================================================================
# Run with: pytest --cov=app --cov-report=html
# View results: open htmlcov/index.html

[coverage:run]
source = app
omit =
    */tests/*
    */venv/*
    */env/*
    */__pycache__/*
    */site-packages/*

[coverage:report]
# Show 2 decimal places in coverage percentages
precision = 2

# Show lines that weren't covered
show_missing = True

# Don't hide fully covered files
skip_covered = False

# Fail if coverage is below this threshold (when using --cov-fail-under)
# Target: 80% overall coverage
fail_under = 80

# Exclude these lines from coverage (useful for defensive code)
exclude_lines =
    # Standard pragma
    pragma: no cover

    # Don't complain about debug code
    def __repr__

    # Don't complain if non-runnable code isn't run
    if __name__ == .__main__.:
    if TYPE_CHECKING:

    # Don't complain about abstract methods
    raise NotImplementedError

    # Don't complain about defensive assertions
    assert False
    raise AssertionError

[coverage:html]
# Output directory for HTML coverage report
directory = htmlcov
